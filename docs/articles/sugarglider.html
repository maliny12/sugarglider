<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>sugarglider • sugarglider</title>
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="sugarglider">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">sugarglider</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/sugarglider.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/Examples.html">Examples</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Change Log</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/maliny12/sugarglider/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>sugarglider</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/maliny12/sugarglider/blob/HEAD/vignettes/sugarglider.Rmd" class="external-link"><code>vignettes/sugarglider.Rmd</code></a></small>
      <div class="d-none name"><code>sugarglider.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>The <code>sugarglider</code> package extends the capabilities of
ggplot2 by introducing functions specifically designed for visualizing
seasonal patterns in spatio-temporal data. It includes
<code><a href="../reference/geom_glyph_ribbon.html">geom_glyph_ribbon()</a></code> and <code><a href="../reference/geom_glyph_segment.html">geom_glyph_segment()</a></code> ,
which represent measurements recorded over time at specific locations
through the use of glyph maps. These functions enable clear depictions
of seasonal trends by leveraging the combination of <em>x_major</em> and
<em>y_major</em> coordinates.</p>
<p>The structure of glyph maps in <code>sugarglider</code> consists of
four main layers: the base map, glyph boxes, reference lines, and ribbon
or segment glyphs. Additionally, users can create a legend, adding an
extra layer to the glyph maps. Apart from the base map, sugarglider
offers functionalities to generate all the elements of a comprehensive
glyph map, as illustrated in the figure below.</p>
<p><img src="../reference/figures/glyphmap-layers.png"> Each layer can be
plotted independently, and the package supports the creation of glyph
plots using either ribbon or segment geometries. The core functionality
includes:</p>
<ul>
<li><p><code><a href="../reference/geom_glyph_ribbon.html">geom_glyph_ribbon()</a></code>: Displays an interval on the
y-axis for each <em>x_minor</em> value, with the bounds defined by
<em>ymin_minor</em> and <em>ymax_minor</em>. This function draws ribbon
geometry using <code><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon()</a></code> from ggplot2 to draw ribbon
geometry, resulting in ribbon glyphs. Each glyph is plotted based on the
combination of <em>x_major</em> and <em>y_major</em> coordinates. This
functionality is particularly useful for visualizing ranges or
uncertainties in the data.</p></li>
<li><p><code><a href="../reference/geom_glyph_segment.html">geom_glyph_segment()</a></code>: Connects <em>y_minor</em> to
<em>yend_minor</em> with a straight line using
<code><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html" class="external-link">geom_segment()</a></code> from ggplot2, resulting in segment glyphs.
Each glyph is plotted based on the combination of <em>x_major</em> and
<em>y_major</em> coordinates.</p></li>
</ul>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vic_temp</span> <span class="op">&lt;-</span> <span class="va">aus_temp</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ASN00026021"</span>, <span class="st">"ASN00085291"</span>, <span class="st">"ASN00084143"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define a color palette</span></span>
<span><span class="va">color_palette</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"deepskyblue4"</span>, <span class="st">"coral3"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="va">vic_temp</span> <span class="op">|&gt;</span></span>
<span>   <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x_major <span class="op">=</span> <span class="va">long</span>,</span>
<span>              y_major <span class="op">=</span> <span class="va">lat</span>,</span>
<span>              x_minor <span class="op">=</span> <span class="va">month</span>,</span>
<span>              ymin_minor <span class="op">=</span> <span class="va">tmin</span>,</span>
<span>              ymax_minor <span class="op">=</span> <span class="va">tmax</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">abs_ste</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">NAME</span> <span class="op">==</span> <span class="st">"Victoria"</span><span class="op">)</span>,</span>
<span>          fill <span class="op">=</span> <span class="st">"antiquewhite"</span>, color <span class="op">=</span> <span class="st">"white"</span>, inherit.aes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>  <span class="op">+</span></span>
<span>  <span class="co"># Customize the size of each glyph box using the width and height parameters.</span></span>
<span>  <span class="fu"><a href="../reference/add_glyph_boxes.html">add_glyph_boxes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">color_palette</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/add_ref_lines.html">add_ref_lines</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">color_palette</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_glyph_ribbon.html">geom_glyph_ribbon</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">color_palette</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, fill <span class="op">=</span> <span class="va">color_palette</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Theme and aesthetic</span></span>
<span>  <span class="fu"><a href="../reference/theme_glyph.html">theme_glyph</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"geom_glyph_ribbon()"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>        title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">color_palette</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>                             family  <span class="op">=</span> <span class="st">"mono"</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="va">vic_temp</span> <span class="op">|&gt;</span></span>
<span>   <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x_major <span class="op">=</span> <span class="va">long</span>,</span>
<span>              y_major <span class="op">=</span> <span class="va">lat</span>,</span>
<span>              x_minor <span class="op">=</span> <span class="va">month</span>,</span>
<span>              y_minor <span class="op">=</span> <span class="va">tmin</span>,</span>
<span>              yend_minor <span class="op">=</span> <span class="va">tmax</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">abs_ste</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">NAME</span> <span class="op">==</span> <span class="st">"Victoria"</span><span class="op">)</span>,</span>
<span>         fill <span class="op">=</span> <span class="st">"antiquewhite"</span>, color <span class="op">=</span> <span class="st">"white"</span>, inherit.aes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>  <span class="op">+</span></span>
<span>  <span class="co"># Customize the size of each glyph box using the width and height parameters.</span></span>
<span>  <span class="fu"><a href="../reference/add_glyph_boxes.html">add_glyph_boxes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">color_palette</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/add_ref_lines.html">add_ref_lines</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">color_palette</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_glyph_segment.html">geom_glyph_segment</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">color_palette</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Theme and aesthetic</span></span>
<span>  <span class="fu"><a href="../reference/theme_glyph.html">theme_glyph</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"geom_glyph_segment()"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>        title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">color_palette</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">grid.arrange</span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> </span></code></pre></div>
<p><img src="sugarglider_files/figure-html/unnamed-chunk-2-1.png" width="960"></p>
<p>In addition to these two functions, sugarglider offers several other
features that enhance the customization of glyph maps. The
<code>add_ref_box()</code> function introduces reference boxes that
visually frame individual glyphs, helping to define boundaries and
distinguish glyphs from each other. The <code>add_ref_line()</code>
function draws a horizontal midpoint for each glyph, facilitating
comparisons across data points. The <code><a href="../reference/add_glyph_legend.html">add_glyph_legend()</a></code>
function allows users to display an enlarged version of a randomly
chosen glyph in the bottom-left corner of the panel, enabling users to
visualize the data range. Lastly, the <code><a href="../reference/theme_glyph.html">theme_glyph()</a></code>
function provides a customized theme for glyph maps, built on top of
<code>theme_map()</code> from <code>ggthemes</code>. It adjusts the
plot’s appearance, including the legend position, text styles, and
background settings, to create a clean, visually consistent layout for
glyph visualizations.</p>
</div>
<div class="section level2">
<h2 id="aesthetics">Aesthetics<a class="anchor" aria-label="anchor" href="#aesthetics"></a>
</h2>
<p>sugarglider provides the same aesthetics for
<code><a href="../reference/geom_glyph_ribbon.html">geom_glyph_ribbon()</a></code> and <code><a href="../reference/geom_glyph_segment.html">geom_glyph_segment()</a></code>
as those available in <code><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon()</a></code> and
<code><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html" class="external-link">geom_segment()</a></code> from ggplot2. To include a variable in the
glyph plot, it must be specified as an aesthetic. The functions in
sugarglider expect spatial coordinates as the major axis and temporal
data, along with some measurements, as the minor axis.</p>
<p>To produce glyph-maps, the following aesthetics are required:</p>
<table class="table">
<colgroup>
<col width="23%">
<col width="76%">
</colgroup>
<thead><tr class="header">
<th>Aesthetics</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>
<code>x_major</code>,<code>y_major</code>
</td>
<td>Spatial coordinates that define the position of glyphs.</td>
</tr>
<tr class="even">
<td><code>x_minor</code></td>
<td>Represents temporal data associated with each glyph.</td>
</tr>
<tr class="odd">
<td>
<code>ymin_minor</code>, <code>ymax_minor</code>
</td>
<td>Used by <code><a href="../reference/geom_glyph_ribbon.html">geom_glyph_ribbon()</a></code> to establish the lower and
upper bounds of the ribbon geometry within each glyph.</td>
</tr>
<tr class="even">
<td>
<code>y_minor</code>, <code>yend_minor</code>
</td>
<td>Used by <code><a href="../reference/geom_glyph_segment.html">geom_glyph_segment()</a></code> to set the start and end
points of the segment geometry within each glyph.</td>
</tr>
</tbody>
</table>
<p>The functions <code>add_ref_box()</code>,
<code>add_ref_line()</code>, and <code>add_geom_legend()</code> are
compatible with either <em>ymin_minor</em>, <em>ymax_minor</em>, or
<em>y_minor</em>, <em>yend_minor</em>. Additionally, sugarglider
introduces several customizable options to further tailor the visual
aspects:</p>
<table class="table">
<colgroup>
<col width="20%">
<col width="16%">
<col width="64%">
</colgroup>
<thead><tr class="header">
<th>Option</th>
<th>Default</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>colour</code></td>
<td><code>"black"</code></td>
<td>Sets the color for line segments and borders.</td>
</tr>
<tr class="even">
<td><code>linewidth</code></td>
<td><code>0.5</code></td>
<td>Specifies the width of the line for borders.</td>
</tr>
<tr class="odd">
<td><code>linetype</code></td>
<td><code>1</code></td>
<td>Defines the style of the line for borders.</td>
</tr>
<tr class="even">
<td><code>fill</code></td>
<td><code>"black"</code></td>
<td>Determines the color of the interior area of the geometries.</td>
</tr>
<tr class="odd">
<td><code>alpha</code></td>
<td><code>0.8</code></td>
<td>Controls the transparency level of the glyphs.</td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="options">Options<a class="anchor" aria-label="anchor" href="#options"></a>
</h2>
<p>Options within the <code>sugarglider</code> package allow you to
tailor the behavior of your visualizations to meet the specific needs of
your analysis. The <em>global_rescale</em> argument provides control
over whether rescaling should occur globally across all data points or
be handled individually for each glyph.</p>
<p><code>sugarglider</code> also offers a variety of customizable
features to enhance the flexibility and precision of visualizations. For
example, it facilitates the scaling of minor values within the glyph
along both the x and y axes. Users can specify their own rescale
function by replacing <em>“identity”</em> with a custom function in
<em>x_scale</em> and <em>y_scale</em>. If a user wishes to modify the
rescaling function on only one axis, they can replace the value of the
corresponding parameter with their chosen function and retain “identity”
for the other. In this package, “identity” rescale the minor axes to an
interval of [-1,1]. The impact of rescaling on glyphs and its
implications for visual interpretation will be thoroughly discussed in
the upcoming section.</p>
<p>Additionally, the width and height of the glyphs are adjustable,
allowing users to modify the appearance of each glyph to match the
dimensions and scaling of the data being visualized. These customization
options ensure that sugarglider can adapt to a broad range of data types
and requirements, making it a versatile tool for seasonal spatiotemporal
data visualization.</p>
<table class="table">
<colgroup>
<col width="20%">
<col width="16%">
<col width="64%">
</colgroup>
<thead><tr class="header">
<th>Option</th>
<th>Default</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>x_scale</code></td>
<td><code>"identity"</code></td>
<td>This function scales each set of minor values within a grid cell
along the x-dimension.</td>
</tr>
<tr class="even">
<td><code>y_scale</code></td>
<td><code>"identity"</code></td>
<td>This function scales each set of minor values within a grid cell
along the y-dimension.</td>
</tr>
<tr class="odd">
<td><code>width</code></td>
<td><code>default</code></td>
<td>The width of each glyph. The <code>default</code> is set to the
smallest distance between two consecutive coordinates, converted from
meters to degrees of latitude using the Haversine method.</td>
</tr>
<tr class="even">
<td><code>height</code></td>
<td><code>default</code></td>
<td>The height of each glyph. The <code>default</code> is calculated
using the ratio (1:1.618) relative to the <code>width</code>, to
maintain a consistent aspect ratio.</td>
</tr>
<tr class="odd">
<td><code>global_rescale</code></td>
<td><code>TRUE</code></td>
<td>Determines whether rescaling is applied globally across all glyphs
or individually for each glyph</td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="interactivity">Interactivity<a class="anchor" aria-label="anchor" href="#interactivity"></a>
</h2>
<p>Interactive graphics are particularly useful when working with
spatio-temporal data as they allow users to explore the data from
multiple perspectives. The <a href="https://huizezhang-sherry.github.io/cubble/articles/cb6interactive.html" class="external-link">cubble</a>
package exemplifies this by creating linked interactive plots using
<code>crosswalk::bscols()</code>. In this vignette, we will demonstrate
how to create interactive glyph maps using Leaflet and ggiraph.</p>
<div class="section level3">
<h3 id="create-glyph-maps-with-leaflet">Create glyph maps with leaflet<a class="anchor" aria-label="anchor" href="#create-glyph-maps-with-leaflet"></a>
</h3>
<p>The dataset used in this example, <code>train</code>, provides a
comprehensive monthly summary of hourly patronage at each train station
in Victoria for the fiscal year 2023-2024. To create interactive glyph
maps with Leaflet, we first need to save each glyph as a PNG and then
add these to the Leaflet basemap as icons. The process starts by
creating a list of unique train stations, then iterates through each
station to generate ribbon glyphs using
<code><a href="../reference/geom_glyph_ribbon.html">geom_glyph_ribbon()</a></code>, <code><a href="../reference/add_glyph_boxes.html">add_glyph_boxes()</a></code> and
<code><a href="../reference/add_ref_lines.html">add_ref_lines()</a></code>. Each glyph is saved in PNG format, and the
file paths for all the PNGs are stored in an object for the next
step.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Generate a list of unique train stations </span></span>
<span><span class="va">df_station</span> <span class="op">&lt;-</span> <span class="va">train</span><span class="op">$</span><span class="va">station_name</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Generate PNG of all the ribbon glyph</span></span>
<span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">df_station</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">dt</span> <span class="op">&lt;-</span> <span class="va">train</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">station_name</span> <span class="op">==</span> <span class="va">df_station</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">p</span> <span class="op">&lt;-</span> <span class="va">dt</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x_major <span class="op">=</span> <span class="va">long</span>, y_major <span class="op">=</span> <span class="va">lat</span>,</span>
<span>                   x_minor <span class="op">=</span> <span class="va">hour</span>, ymin_minor <span class="op">=</span> <span class="va">min_weekday</span>,</span>
<span>                   ymax_minor <span class="op">=</span> <span class="va">max_weekday</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/add_glyph_boxes.html">add_glyph_boxes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"#ffc40d"</span>, </span>
<span>                    fill <span class="op">=</span> <span class="st">"#eff4ff"</span>, alpha <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>                    linewidth <span class="op">=</span> <span class="fl">2</span>, width <span class="op">=</span> <span class="fl">3</span>, height  <span class="op">=</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/add_ref_lines.html">add_ref_lines</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"#ffc40d"</span>, alpha <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                  linewidth <span class="op">=</span> <span class="fl">2</span>, width <span class="op">=</span> <span class="fl">3</span>, height  <span class="op">=</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/geom_glyph_ribbon.html">geom_glyph_ribbon</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"#2b5797"</span>, fill <span class="op">=</span> <span class="st">"#2b5797"</span>,</span>
<span>                      width <span class="op">=</span> <span class="fl">3</span>, height  <span class="op">=</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span> </span>
<span>  </span>
<span>  <span class="va">file_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"../man/figures/glyph_"</span>, <span class="va">df_station</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="st">".png"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html" class="external-link">ggsave</a></span><span class="op">(</span><span class="va">file_path</span>, plot <span class="op">=</span> <span class="va">p</span>, width <span class="op">=</span> <span class="fl">3</span>, height <span class="op">=</span> <span class="fl">2</span>, units <span class="op">=</span> <span class="st">"in"</span>,</span>
<span>         path <span class="op">=</span> <span class="st">"../man/figures"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="op">}</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">train_png</span> </span></code></pre></div>
<p>To create the base map for Leaflet, we use the <code>leaflet()</code>
function and <code>addProviderTiles()</code> with <a href="https://github.com/CartoDB/basemap-styles" class="external-link">CartoDB.Positron</a> as
the provider to achieve a light, grey map aesthetic. Additionally, a
scale bar is added at the bottom left corner for reference.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a leaflet map </span></span>
<span><span class="va">leaflet_map</span> <span class="op">&lt;-</span> <span class="fu">leaflet</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">addProviderTiles</span><span class="op">(</span><span class="st">"CartoDB.Positron"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">addScaleBar</span><span class="op">(</span>position <span class="op">=</span> <span class="st">"bottomleft"</span><span class="op">)</span></span></code></pre></div>
<p>Next, we iterate through all the PNG files and convert them into
icons using the <code>makeIcon()</code> function. Users can control the
dimensions of each icon by modifying the <code>iconWidth</code> and
<code>iconHeight</code> arguments. The final step is to add each icon to
the Leaflet map using <code>addMarkers()</code>. Within the options
argument of <code>addMarkers</code>, users can fine-tune each glyph’s
display properties, such as the opacity level. The <code>label</code>
argument allows users to specify the information they wish to display
with the hover-over effect, which in this example is set to display the
station ID.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Loop through the PNG files and add them to the map</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">train_png</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">icon</span> <span class="op">&lt;-</span> <span class="fu">makeIcon</span><span class="op">(</span>iconUrl <span class="op">=</span> <span class="va">train_png</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, iconWidth <span class="op">=</span> <span class="fl">100</span>, iconHeight <span class="op">=</span> <span class="fl">60</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">dt</span> <span class="op">&lt;-</span> <span class="va">train</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">station_name</span> <span class="op">==</span> <span class="va">df_station</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">leaflet_map</span> <span class="op">&lt;-</span> <span class="va">leaflet_map</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">addMarkers</span><span class="op">(</span>lng <span class="op">=</span> <span class="va">dt</span><span class="op">$</span><span class="va">long</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, lat <span class="op">=</span> <span class="va">dt</span><span class="op">$</span><span class="va">lat</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, icon <span class="op">=</span> <span class="va">icon</span>,</span>
<span>               label <span class="op">=</span> <span class="va">dt</span><span class="op">$</span><span class="va">station_name</span>, options <span class="op">=</span> <span class="fu">markerOptions</span><span class="op">(</span>opacity <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">leaflet_map</span></span></code></pre></div>
<p><img src="../reference/figures/leaflet-screenshot.jpg"></p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Maliny Po, S. Nathan Yang.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
